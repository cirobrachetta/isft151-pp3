<?xml version="1.0" encoding="UTF-8"?>
<queries>
    <query id="users.insertUser">
    <![CDATA[
        INSERT INTO users (username, password_hash, active, created_at)
        VALUES (:username, :hash, 1, CURRENT_TIMESTAMP);
    ]]>
    </query>

    <query id="users.selectUserByUsername">
    <![CDATA[
        SELECT id, username, password_hash, active, created_at
        FROM users WHERE username = :username;
    ]]>
    </query>

    <query id="users.selectUserById">
    <![CDATA[
        SELECT id, username, password_hash, active, created_at
        FROM users WHERE id = :id;
    ]]>
    </query>

    <query id="users.selectUsers">
    <![CDATA[
        SELECT id, username, active, created_at
        FROM users ORDER BY id;
    ]]>
    </query>

    <query id="users.updateUserById">
    <![CDATA[
        UPDATE users SET username = :username, password_hash = :hash
        WHERE id = :id;
    ]]>
    </query>

    <query id="users.deleteUserById">
    <![CDATA[
        DELETE FROM users WHERE id = :id;
    ]]>
    </query>

    <query id="users.existsUserByUsername">
    <![CDATA[
        SELECT EXISTS(SELECT 1 FROM users WHERE username = :username) AS found;
    ]]>
    </query>

    <!-- PRODUCT SALES -->
    <query id="sales.insertProductSale">
    <![CDATA[
    INSERT INTO product_sales (event_id, user_id, created_at)
    VALUES (:event_id, :user_id, CURRENT_TIMESTAMP);
    ]]>
    </query>

    <query id="sales.insertProductSaleItem">
    <![CDATA[
    INSERT INTO product_sale_items (sale_id, product_id, qty, unit_price)
    VALUES (:sale_id, :product_id, :qty, :unit_price);
    ]]>
    </query>

    <query id="sales.selectProductSaleById">
    <![CDATA[
    SELECT id, event_id, user_id, created_at FROM product_sales WHERE id = :id;
    ]]>
    </query>

    <query id="sales.selectProductSaleItemsBySaleId">
    <![CDATA[
    SELECT sale_id, product_id, qty, unit_price FROM product_sale_items WHERE sale_id = :sale_id;
    ]]>
    </query>

    <query id="sales.deleteProductSaleById">
    <![CDATA[
    DELETE FROM product_sales WHERE id = :id;
    ]]>
    </query>

    <query id="sales.deleteProductSaleItemsBySaleId">
    <![CDATA[
    DELETE FROM product_sale_items WHERE sale_id = :sale_id;
    ]]>
    </query>

    <!-- PURCHASES -->
    <query id="purchases.insertPurchase">
    <![CDATA[
    INSERT INTO purchases (supplier_id, user_id, invoice_ref, created_at)
    VALUES (:supplier_id, :user_id, :invoice_ref, CURRENT_TIMESTAMP);
    ]]>
    </query>

    <query id="purchases.insertPurchaseItem">
    <![CDATA[
    INSERT INTO purchase_items (purchase_id, product_id, qty, unit_cost)
    VALUES (:purchase_id, :product_id, :qty, :unit_cost);
    ]]>
    </query>

    <query id="purchases.selectPurchaseById">
    <![CDATA[
    SELECT id, supplier_id, user_id, invoice_ref, created_at FROM purchases WHERE id = :id;
    ]]>
    </query>

    <query id="purchases.selectPurchaseItemsByPurchaseId">
    <![CDATA[
    SELECT purchase_id, product_id, qty, unit_cost FROM purchase_items WHERE purchase_id = :purchase_id;
    ]]>
    </query>

    <query id="purchases.deletePurchaseById">
    <![CDATA[
    DELETE FROM purchases WHERE id = :id;
    ]]>
    </query>

    <query id="purchases.deletePurchaseItemsByPurchaseId">
    <![CDATA[
    DELETE FROM purchase_items WHERE purchase_id = :purchase_id;
    ]]>
    </query>

    <!-- PRODUCTS minimal helpers -->
    <query id="products.selectProductById">
    <![CDATA[
    SELECT id, name, category_id, supplier_id, cost, price, stock, min_stock, active FROM products WHERE id = :id;
    ]]>
    </query>

    <!-- CASH MOVEMENTS -->
    <query id="cash.insertMovement">
    <![CDATA[
        INSERT INTO cash_movements (type, amount, description, created_at)
        VALUES (:type, :amount, :description, CURRENT_TIMESTAMP);
    ]]>
    </query>

    <query id="cash.selectAllMovements">
    <![CDATA[
        SELECT id, type, amount, description, created_at
        FROM cash_movements
        ORDER BY created_at DESC;
    ]]>
    </query>

    <query id="cash.selectMovementById">
    <![CDATA[
        SELECT id, type, amount, description, created_at
        FROM cash_movements
        WHERE id = :id;
    ]]>
    </query>

    <query id="cash.deleteMovementById">
    <![CDATA[
        DELETE FROM cash_movements WHERE id = :id;
    ]]>
    </query>

    <!-- PAYMENTS -->
    <query id="payments.insertPayment">
    <![CDATA[
        INSERT INTO payments (debt_id, amount, paid_at)
        VALUES (:debt_id, :amount, CURRENT_TIMESTAMP);
    ]]>
    </query>

    <query id="payments.selectPaymentsByDebtId">
    <![CDATA[
        SELECT id, debt_id, amount, paid_at
        FROM payments
        WHERE debt_id = :debt_id;
    ]]>
    </query>

    <query id="payments.selectPaymentById">
    <![CDATA[
        SELECT id, debt_id, amount, paid_at
        FROM payments
        WHERE id = :id;
    ]]>
    </query>

    <query id="payments.deletePaymentById">
    <![CDATA[
        DELETE FROM payments WHERE id = :id;
    ]]>
    </query>

    <!-- DEBTS -->
    <query id="debts.insertDebt">
    <![CDATA[
        INSERT INTO debts (entity_type, entity_id, amount, description, due_date, created_at)
        VALUES (:entity_type, :entity_id, :amount, :description, :due_date, CURRENT_TIMESTAMP);
    ]]>
    </query>

    <query id="debts.selectDebtById">
    <![CDATA[
        SELECT id, entity_type, entity_id, amount, description, due_date, created_at
        FROM debts
        WHERE id = :id;
    ]]>
    </query>

    <query id="debts.selectAllDebts">
    <![CDATA[
        SELECT id, entity_type, entity_id, amount, description, due_date, created_at
        FROM debts
        ORDER BY due_date ASC;
    ]]>
    </query>

    <query id="debts.deleteDebtById">
    <![CDATA[
        DELETE FROM debts WHERE id = :id;
    ]]>
    </query>
</queries>